#!/usr/bin/env bash
set -euo pipefail

# Skip the build only when every changed file lives under sticky-notes/.
# CACHED_COMMIT_REF is empty on the first build, so keep the build in that case.
if [ -z "${CACHED_COMMIT_REF:-}" ]; then
  exit 1
fi

changed_files="$(git diff --name-only "$CACHED_COMMIT_REF" "$COMMIT_REF" || true)"

# If there are changes outside sticky-notes/, build must run.
if printf '%s\n' "$changed_files" | grep -Ev '^(sticky-notes/|$)' >/dev/null; then
  exit 1
fi

echo "Netlify: only sticky-notes/ changes detected; skipping build."
exit 0
