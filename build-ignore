#!/usr/bin/env bash
set -euo pipefail

# Skip the build only when every changed file lives under one of the media folders.
# CACHED_COMMIT_REF is empty on the first build, so keep the build in that case.
if [ -z "${CACHED_COMMIT_REF:-}" ]; then
  exit 1
fi

changed_files="$(git diff --name-only "$CACHED_COMMIT_REF" "$COMMIT_REF" || true)"

# If there are changes outside the allowed folders, a build must run.
if printf '%s\n' "$changed_files" | grep -Ev '^(sticky-notes/|banners/|bookmarks/|backgrounds/|presentations/|imgs/|headshots/|props/|var/|$)' >/dev/null; then
  exit 1
fi

echo "Netlify: only media-folder changes detected; skipping build."
exit 0
